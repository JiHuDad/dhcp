# DHCPv6 Server Configuration with Vendor-Specific Options Support
# Example configuration for ISC DHCP with integrated vendor options

# Global settings
default-lease-time 7200;
max-lease-time 86400;
authoritative;

# Enable DHCPv6
dhcpv6-lease-file-name "/var/lib/dhcp/dhcpd6.leases";
dhcpv6-pid-file-name "/var/run/dhcpd6.pid";

# Global IPv6 options
option dhcp6.name-servers 2001:db8::1, 2001:db8::2;
option dhcp6.domain-search "example.com", "test.example.com";

# Define enterprise-specific vendor option space
# This example uses enterprise number 12345
option space enterprise-12345;
option enterprise-12345.serial-number code 71 = text;
option enterprise-12345.signature code 72 = text;
option enterprise-12345.client-cert code 73 = text;
option enterprise-12345.signature-dup code 74 = text;
option enterprise-12345.server-cert-chain code 77 = text;

# Vendor-specific option configuration
# This shows the implemented vendor-config syntax

# Vendor configuration for enterprise 12345
vendor-config enterprise-12345 {
    # Enable vendor options processing
    enabled true;
    auto-respond true;
    
    # Cryptographic settings
    private-key "/etc/dhcp/vendor/server.key";
    certificate-chain "/etc/dhcp/vendor/cert_chain.pem";
    require-signature true;
    
    # Sub-option configuration
    sub-option 71 {
        type "serial-number";
        validate true;
    }
    
    sub-option 72 {
        type "signature";
        algorithm "rsa-sha256";
        required true;
    }
    
    sub-option 73 {
        type "certificate";
        save-path "/var/lib/dhcp/client-certs/";
    }
    
    sub-option 77 {
        type "certificate-chain";
        certificate-chain "/etc/dhcp/vendor/response_chain.pem";
    }
}

# IPv6 subnet configuration
subnet6 2001:db8:100::/64 {
    # Address range for normal clients
    range6 2001:db8:100::10 2001:db8:100::100;
    
    # Prefix delegation
    prefix6 2001:db8:200:: 2001:db8:2ff:: /56;
    
    # Standard IPv6 options
    option dhcp6.name-servers 2001:db8:100::1;
    option dhcp6.domain-search "subnet.example.com";
}

# Host-specific configuration for vendor clients
host vendor-client-001 {
    # Client identification
    host-identifier option dhcp6.client-id 00:01:00:01:12:34:56:78:00:11:22:33:44:55;
    
    # Fixed address assignment
    fixed-address6 2001:db8:100::201;
    
    # Vendor-specific configuration
    # This host is covered by the global vendor-config enterprise-12345 block
}

host vendor-client-002 {
    host-identifier option dhcp6.client-id 00:01:00:01:87:65:43:21:aa:bb:cc:dd:ee:ff;
    fixed-address6 2001:db8:100::202;
    # This host is also covered by the global vendor-config enterprise-12345 block
}

# Shared network configuration
shared-network "vendor-network" {
    subnet6 2001:db8:300::/64 {
        range6 2001:db8:300::10 2001:db8:300::100;
        
        # Enable vendor options for this subnet
        # vendor-config enterprise-12345 {
        #     enabled true;
        #     auto-respond true;
        # }
    }
    
    subnet6 2001:db8:400::/64 {
        range6 2001:db8:400::10 2001:db8:400::100;
    }
}

# Class-based configuration for vendor devices
class "vendor-devices" {
    match if option dhcp6.vendor-class = "VendorDevice-v1.0";
    
    # Special lease time for vendor devices
    default-lease-time 3600;
    max-lease-time 7200;
    
    # vendor-config enterprise-12345 {
    #     enabled true;
    #     require-signature true;
    # }
}

# Group configuration
group {
    # Group-specific vendor configuration
    # vendor-config enterprise-12345 {
    #     enabled true;
    #     auto-respond false;  # Manual approval required
    # }
    
    host vendor-group-client-001 {
        host-identifier option dhcp6.client-id 00:01:00:01:11:11:11:11:11:11:11:11:11:11;
        fixed-address6 2001:db8:100::301;
    }
    
    host vendor-group-client-002 {
        host-identifier option dhcp6.client-id 00:01:00:01:22:22:22:22:22:22:22:22:22:22;
        fixed-address6 2001:db8:100::302;
    }
}

# Logging configuration
log-facility local0;

# Security settings
# Note: These would be enhanced to support vendor option security
deny unknown-clients;
allow known-clients;

# Additional DHCPv6 options
option dhcp6.preference 255;
option dhcp6.rapid-commit;

# Information refresh time (RFC 4242)
option dhcp6.info-refresh-time 3600;

# End of configuration